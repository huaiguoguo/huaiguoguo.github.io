是的，确实不建议直接修改 `/etc/sudoers` 文件，而是推荐在 `/etc/sudoers.d/` 目录下创建新的文件来进行权限配置。这种做法被认为是更安全、稳定和便于管理的。

### 原因及优点：
1. **避免错误修改**：
   - `/etc/sudoers` 文件非常重要，它控制系统中哪些用户可以使用 `sudo` 命令。如果你直接编辑该文件并出现语法错误，可能会导致 `sudo` 命令无法正常工作，甚至锁定自己无法获得管理员权限。
   - 使用 `visudo` 命令编辑 `/etc/sudoers` 文件可以进行语法检查，但如果直接在 `/etc/sudoers.d/` 目录下创建独立的配置文件，整体风险更低，因为你只影响新增的部分，不会破坏现有的配置。

2. **模块化配置**：
   - 在 `/etc/sudoers.d/` 目录下新增文件，可以按用户、组或特定功能分离配置。每个文件只需要管理对应用户或用户组的 sudo 权限，方便维护和调试。相比修改一个庞大的 `/etc/sudoers` 文件，这种方式更清晰、模块化。

3. **系统更新时更安全**：
   - `/etc/sudoers` 文件是系统的核心配置文件，系统升级或维护时可能会覆盖这个文件。如果你将配置放在 `/etc/sudoers.d/` 目录下，即使 `/etc/sudoers` 文件被系统更新覆盖，单独的配置文件仍然可以保持不变。

### 正确操作方式：

1. **使用 `visudo` 编辑**：
   - 即使在 `/etc/sudoers.d/` 目录下添加文件，也应该通过 `visudo` 命令进行编辑。`visudo` 会自动检查语法错误，确保不会破坏系统配置。
   
   你可以通过以下命令来编辑 `/etc/sudoers` 或 `/etc/sudoers.d` 目录中的文件：
   ```bash
   sudo visudo -f /etc/sudoers.d/your_custom_file
   ```

2. **文件命名规则**：
   - 在 `/etc/sudoers.d/` 目录下创建的文件可以按你自己的规则命名，比如以用户名命名，或者以特定功能命名，例如：
     - `/etc/sudoers.d/john`
     - `/etc/sudoers.d/web_admins`
   - 需要注意的是，这些文件应该避免使用特殊字符，并且**文件名不能包含`.`（点号）**，因为一些版本的 `sudo` 会忽略带点的文件。

3. **文件格式示例**：
   在 `/etc/sudoers.d/` 目录下新建文件后，文件内容的格式与 `/etc/sudoers` 文件中的格式一致。例如，为用户 `john` 添加 `sudo` 权限，可以创建 `/etc/sudoers.d/john` 文件，内容如下：

   ```bash
   john ALL=(ALL:ALL) ALL
   ```

### 总结：
- **不直接修改 `/etc/sudoers`** 是为了防止误操作和语法错误带来的风险。
- 在 `/etc/sudoers.d/` 目录下创建独立文件进行权限配置，可以提高配置的模块化和安全性，并且系统更新时不易受到影响。
- 始终使用 `visudo` 进行编辑，以确保语法正确。

通过这种方式，你可以更灵活、安全地管理系统中用户的 `sudo` 权限。

<br/>
<br/>
<br/>
<br/>


“文件格式示例” 是指在 `/etc/sudoers.d/` 目录中创建的新文件应遵循特定的语法格式，这与 `/etc/sudoers` 文件的语法一致。这里的“格式”是指你在这些文件中如何定义用户或用户组的 `sudo` 权限。

### 1. **基本的 sudoers 语法结构**
在 `/etc/sudoers` 文件或 `/etc/sudoers.d/` 目录中的文件，常用的格式如下：

```
<用户或用户组> <主机> = (<运行身份>) <可以执行的命令>
```

- `<用户或用户组>`：指定哪个用户或用户组有权限。用户名前面直接写用户名，而用户组前面加上 `%`。
- `<主机>`：指定在哪台主机上（或在所有主机上）允许用户执行命令。通常使用 `ALL` 来表示所有主机。
- `<运行身份>`：指定用户可以以哪个身份运行命令，通常是 `ALL` 或 `root`。
- `<可以执行的命令>`：用户有权限执行的具体命令，使用 `ALL` 表示所有命令。

### 2. **文件格式示例**
举个具体的例子，假设你想为用户 `john` 提供 `sudo` 权限，并允许他执行所有命令。你可以在 `/etc/sudoers.d/` 目录下创建一个名为 `john` 的文件，其内容如下：

```bash
john ALL=(ALL:ALL) ALL
```

#### 各部分解释：
- `john`：这是要赋予 sudo 权限的用户。
- `ALL`：表示该权限在所有主机上都有效。
- `(ALL:ALL)`：表示 `john` 可以以任何用户身份运行命令，特别是 `root` 用户身份。第一个 `ALL` 指代可以使用任何用户身份，第二个 `ALL` 允许使用任意组身份。
- `ALL`：表示 `john` 可以执行所有命令。

### 3. **针对特定命令赋权的示例**
如果你只想让 `john` 以 root 身份运行 `systemctl restart apache2` 这个命令，可以这样配置：

```bash
john ALL=(root) /bin/systemctl restart apache2
```

#### 各部分解释：
- `john`：用户 `john`。
- `ALL`：在所有主机上。
- `(root)`：以 `root` 用户身份运行。
- `/bin/systemctl restart apache2`：允许 `john` 运行 `systemctl restart apache2` 这个特定命令，而不是所有命令。

### 4. **用户组示例**
假设你有一个用户组叫 `admin`，你想让该组中的所有用户都能使用 `sudo`，可以这样配置：

```bash
%admin ALL=(ALL:ALL) ALL
```

这里 `%admin` 表示该条规则适用于 `admin` 组中的所有用户。

### 5. **NOPASSWD 示例**
如果你不想让用户每次执行 `sudo` 时都输入密码，可以加上 `NOPASSWD` 选项：

```bash
john ALL=(ALL:ALL) NOPASSWD: ALL
```

这意味着 `john` 执行任何 `sudo` 命令时不需要输入密码。

### 总结：
- **文件格式示例** 是指如何在 `/etc/sudoers.d/` 文件中正确定义用户或用户组的 `sudo` 权限。
- 你需要遵循 `sudoers` 文件的特定语法，确保每个配置项清晰地定义了用户、主机、运行身份和可执行命令。
